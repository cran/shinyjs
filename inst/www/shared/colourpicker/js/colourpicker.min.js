!function(r){"function"==typeof define&&define.amd?define(["jquery"],r):"object"==typeof exports?module.exports=r(require("jquery")):r(jQuery)}(function(r){function t(t,e){var o=r('<div class="colourpicker" />'),i=r.colourpicker.defaults;t.data("colourpicker-initialized")||(e=r.extend(!0,{},i,e),void 0!==e.position&&r.each(e.position.split(" "),function(){o.addClass("colourpicker-position-"+this)}),e.allowTransparent&&o.addClass("input-group"),t.addClass("colourpicker-input").prop("spellcheck",!1).data("colourpicker-initialized",!1).data("colourpicker-settings",e).prop("size",7).wrap(o).after('<div class="colourpicker-panel"><div class="colourpicker-slider colourpicker-sprite"><div class="colourpicker-slider-picker"></div></div><div class="colourpicker-grid colourpicker-sprite"><div class="colourpicker-grid-inner"></div><div class="colourpicker-picker"><div></div></div></div><div>'),e.allowTransparent?(t.parent().find(".colourpicker-panel").after('<label class="input-group-addon"><input type="checkbox" class="colourpicker-istransparent"> <span class="colourpicker-transparent-text">'+e.transparentText+"</span></label>"),t.data("allow-transparent",!0)):t.data("allow-transparent",!1),t.parent().find(".colourpicker-panel").on("selectstart",function(){return!1}).end(),n(t,!1),t.data("colourpicker-initialized",!0))}function e(r){var t=r.parent();r.removeData("colourpicker-initialized").removeData("colourpicker-settings").removeProp("size").removeClass("colourpicker-input"),t.before(r).remove()}function o(r){var t=r.parent(),e=t.find(".colourpicker-panel"),o=r.data("colourpicker-settings");!r.data("colourpicker-initialized")||r.prop("disabled")||t.hasClass("colourpicker-focus")||(i(),t.addClass("colourpicker-focus"),e.stop(!0,!0).fadeIn(o.showSpeed,function(){o.show&&o.show.call(r.get(0))}))}function i(){r(".colourpicker-focus").each(function(){var t=r(this),e=t.find(".colourpicker-input"),o=t.find(".colourpicker-panel"),i=e.data("colourpicker-settings");o.fadeOut(i.hideSpeed,function(){i.hide&&i.hide.call(e.get(0)),t.removeClass("colourpicker-focus")})})}function a(r,t,e){var o=r.parents(".colourpicker").find(".colourpicker-input"),i=o.data("colourpicker-settings"),a=r.find("[class$=-picker]"),n=r.offset().left,s=r.offset().top,l=Math.round(t.pageX-n),u=Math.round(t.pageY-s),p=e?i.animationSpeed:0;t.originalEvent.changedTouches&&(l=t.originalEvent.changedTouches[0].pageX-n,u=t.originalEvent.changedTouches[0].pageY-s),0>l&&(l=0),0>u&&(u=0),l>r.width()&&(l=r.width()),u>r.height()&&(u=r.height()),r.is(".colourpicker-grid")?a.stop(!0).animate({top:u+"px",left:l+"px"},p,i.animationEasing,function(){c(o,r)}):a.stop(!0).animate({top:u+"px"},p,i.animationEasing,function(){c(o,r)})}function c(r,t){function e(r,t){var e,o;return r.length&&t?(e=r.offset().left,o=r.offset().top,{x:e-t.offset().left+r.outerWidth()/2,y:o-t.offset().top+r.outerHeight()/2}):null}var o,i,a,c=r.val(),n=r.parent(),l=r.data("colourpicker-settings"),p=n.find(".colourpicker-grid"),d=n.find(".colourpicker-slider"),k=p.find("[class$=-picker]"),g=d.find("[class$=-picker]"),f=e(k,p),b=e(g,d);switch(t.is(".colourpicker-grid, .colourpicker-slider")&&(o=u(360-parseInt(b.y*(360/d.height()),10),0,360),i=u(Math.floor(f.x*(100/p.width())),0,100),a=u(100-Math.floor(f.y*(100/p.height())),0,100),c=h({h:o,s:i,b:a}),p.css("backgroundColor",h({h:o,s:100,b:100})),r.val(c.toUpperCase())),l.showColour){case"text":r.css("color",""),r.css("background-color","");break;case"background":r.css("color","transparent"),r.css("background-color",c);break;default:r.css("color",v(c)),r.css("background-color",c)}s(r,c,r.data("transparent"))}function n(r,t){var e,o,i,a,c=r.parent(),n=r.data("colourpicker-settings"),p=c.find(".colourpicker-grid"),d=c.find(".colourpicker-slider"),g=p.find("[class$=-picker]"),f=d.find("[class$=-picker]");switch(e=l(r.val(),!0).toUpperCase(),e||(e=m(r)),o=k(e),t||r.val(e),n.showColour){case"text":r.css("color",""),r.css("background-color","");break;case"background":r.css("color","transparent"),r.css("background-color",e);break;default:r.css("color",v(e)),r.css("background-color",e)}i=u(Math.ceil(o.s/(100/p.width())),0,p.width()),a=u(p.height()-Math.ceil(o.b/(100/p.height())),0,p.height()),g.css({top:a+"px",left:i+"px"}),a=u(d.height()-o.h/(360/d.height()),0,d.height()),f.css("top",a+"px"),p.css("backgroundColor",h({h:o.h,s:100,b:100})),r.data("colourpicker-initialized")&&s(r,e,r.data("transparent")),r.data("transparent")?(c.find(".colourpicker-istransparent").prop("checked",!0),c.addClass("istransparent")):(c.find(".colourpicker-istransparent").prop("checked",!1),c.removeClass("istransparent")),r.trigger("change").trigger("input")}function s(r,t,e){var o=r.data("colourpicker-settings"),i=r.data("colourpicker-lastChange"),a=r.data("colourpicker-lastTransparent");i&&i===t&&a===e||(r.data("colourpicker-lastChange",t),r.data("colourpicker-lastTransparent",e),o.change&&(o.changeDelay?(clearTimeout(r.data("colourpicker-changeTimeout")),r.data("colourpicker-changeTimeout",setTimeout(function(){o.change.call(r.get(0),t)},o.changeDelay))):o.change.call(r.get(0),t)),r.trigger("change").trigger("input"))}function l(r,t){return r=r.replace(/[^A-F0-9]/gi,""),3!==r.length&&6!==r.length?"":(3===r.length&&t&&(r=r[0]+r[0]+r[1]+r[1]+r[2]+r[2]),"#"+r)}function u(r,t,e){return t>r&&(r=t),r>e&&(r=e),r}function p(r){var t={},e=Math.round(r.h),o=Math.round(255*r.s/100),i=Math.round(255*r.b/100);if(0===o)t.r=t.g=t.b=i;else{var a=i,c=(255-o)*i/255,n=(a-c)*(e%60)/60;360===e&&(e=0),60>e?(t.r=a,t.b=c,t.g=c+n):120>e?(t.g=a,t.b=c,t.r=a-n):180>e?(t.g=a,t.r=c,t.b=c+n):240>e?(t.b=a,t.r=c,t.g=a-n):300>e?(t.b=a,t.g=c,t.r=c+n):360>e?(t.r=a,t.g=c,t.b=a-n):(t.r=0,t.g=0,t.b=0)}return{r:Math.round(t.r),g:Math.round(t.g),b:Math.round(t.b)}}function d(t){var e=[t.r.toString(16),t.g.toString(16),t.b.toString(16)];return r.each(e,function(r,t){1===t.length&&(e[r]="0"+t)}),"#"+e.join("")}function h(r){return d(p(r))}function k(r){var t=g(f(r));return 0===t.s&&(t.h=360),t}function g(r){var t={h:0,s:0,b:0},e=Math.min(r.r,r.g,r.b),o=Math.max(r.r,r.g,r.b),i=o-e;return t.b=o,t.s=0!==o?255*i/o:0,t.h=0!==t.s?r.r===o?(r.g-r.b)/i:r.g===o?2+(r.b-r.r)/i:4+(r.r-r.g)/i:-1,t.h*=60,t.h<0&&(t.h+=360),t.s*=100/255,t.b*=100/255,t}function f(r){return r=parseInt(r.indexOf("#")>-1?r.substring(1):r,16),{r:r>>16,g:(65280&r)>>8,b:255&r}}function v(r){return b(r)>.22?"#000":"#ddd"}function b(t){var e=f(t);e=r.map(e,function(r){return r/=255,r=.03928>=r?r/12.92:Math.pow((r+.055)/1.055,2.4)});var o=.2126*e[0]+.7152*e[1]+.0722*e[2];return o}function m(r){return r.data("colourpicker-lastChange")?r.data("colourpicker-lastChange"):"#FFFFFF"}r.colourpicker={defaults:{animationSpeed:50,animationEasing:"swing",change:null,changeDelay:0,defaultValue:"",hide:null,hideSpeed:100,position:"bottom left",show:null,showSpeed:100,showColour:"both",allowTransparent:!1,transparentText:"Transparent"}},r.extend(r.fn,{colourpicker:function(a,c){switch(a){case"destroy":return r(this).each(function(){e(r(this))}),r(this);case"hide":return i(),r(this);case"settings":return void 0===c?r(this).data("colourpicker-settings"):(r(this).each(function(){var t=r(this).data("colourpicker-settings")||{};e(r(this)),r(this).colourpicker(r.extend(!0,t,c))}),r(this));case"show":return o(r(this).eq(0)),r(this);case"value":return void 0===c?r(this).data("allow-transparent")&&r(this).data("transparent")?"transparent":l(r(this).val())?l(r(this).val(),!0):r(this).data("colourpicker-lastChange"):(r(this).each(function(){"transparent"==c?r(this).data("allow-transparent")?r(this).data("transparent",!0):(r(this).data("transparent",!1),r(this).val(m(r(this)))):(r(this).data("transparent",!1),r(this).val(c)),n(r(this))}),r(this));default:return"create"!==a&&(c=a),r(this).each(function(){t(r(this),c)}),r(this)}}}),r(document).on("mousedown.colourpicker touchstart.colourpicker",function(t){r(t.target).parents().add(t.target).hasClass("colourpicker")||i()}).on("mousedown.colourpicker touchstart.colourpicker",".colourpicker-grid, .colourpicker-slider",function(t){var e=r(this);t.preventDefault(),r(document).data("colourpicker-target",e),a(e,t,!0)}).on("mousemove.colourpicker touchmove.colourpicker",function(t){var e=r(document).data("colourpicker-target");e&&a(e,t)}).on("mouseup.colourpicker touchend.colourpicker",function(){r(this).removeData("colourpicker-target")}).on("focus.colourpicker",".colourpicker-input",function(){var t=r(this);t.data("colourpicker-initialized")&&(t.data("transparent",!1),o(t),n(r(this)))}).on("blur.colourpicker",".colourpicker-input",function(){{var t=r(this);t.data("colourpicker-settings")}t.data("colourpicker-initialized")&&(t.val(l(t.val(),!0)),""===t.val()&&t.val(m(t)),t.val(t.val().toUpperCase()))}).on("keydown.colourpicker",".colourpicker-input",function(t){var e=r(this);if(e.data("colourpicker-initialized"))switch(t.keyCode){case 9:i();break;case 13:case 27:i(),e.blur()}}).on("keyup.colourpicker",".colourpicker-input",function(){var t=r(this);t.data("colourpicker-initialized")&&n(t,!0)}).on("paste.colourpicker",".colourpicker-input",function(){var t=r(this);t.data("colourpicker-initialized")&&setTimeout(function(){n(t,!0)},1)}).on("change.colourpicker-istransparent",".input-group-addon",function(){var t=r(this).siblings(".colourpicker-input"),e=(t.parent(),r(this).find(".colourpicker-istransparent"));i(),t.data("transparent",e.is(":checked")),n(t)})});