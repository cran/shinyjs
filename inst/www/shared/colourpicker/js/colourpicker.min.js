!function(r){"function"==typeof define&&define.amd?define(["jquery"],r):"object"==typeof exports?module.exports=r(require("jquery")):r(jQuery)}(function(r){function e(e,t){var a=r('<div class="colourpicker" />'),o=r.colourpicker.defaults;if(!e.data("colourpicker-initialized")){if(t=r.extend(!0,{},o,t),a.addClass("palette-"+t.palette),t.allowTransparent&&a.addClass("input-group"),e.addClass("colourpicker-input").prop("spellcheck",!1).data("colourpicker-initialized",!1).data("colourpicker-lastChange",!1).data("colourpicker-settings",t).prop("size",7).wrap(a),"square"==t.palette)e.after('<div class="colourpicker-panel"><div class="colourpicker-slider colourpicker-sprite"><div class="colourpicker-slider-picker"></div></div><div class="colourpicker-grid colourpicker-sprite"><div class="colourpicker-grid-inner"></div><div class="colourpicker-picker"><div></div></div></div></div>');else if("limited"==t.palette){var i='<div class="colourpicker-list">';r.each(t.allowedCols.split(" "),function(r,e){0==r?i+='<div class="cp-list-row cp-clearfix">':r%8==0&&(i+='</div><div class="cp-list-row cp-clearfix">'),i+='<span class="cp-list-col" data-cp-col="'+e+'" style="background-color:'+e+'"></span>'}),i+="</div>",e.after('<div class="colourpicker-panel">'+i+"</div>")}else console.log("colourpicker: invalid palette type ("+t.palette+")");t.allowTransparent?(e.parent().find(".colourpicker-panel").after('<label class="input-group-addon"><input type="checkbox" class="colourpicker-istransparent"> <span class="colourpicker-transparent-text">'+t.transparentText+"</span></label>"),e.data("allow-transparent",!0)):e.data("allow-transparent",!1),e.parent().find(".colourpicker-panel").on("selectstart",function(){return!1}).end(),n(e,!1),e.data("colourpicker-initialized",!0)}}function t(r){var e=r.parent();r.removeData("colourpicker-initialized").removeData("colourpicker-settings").removeProp("size").removeClass("colourpicker-input"),e.before(r).remove()}function a(r){var e=r.parent(),t=e.find(".colourpicker-panel"),a=r.data("colourpicker-settings");!r.data("colourpicker-initialized")||r.prop("disabled")||e.hasClass("colourpicker-focus")||(o(),e.addClass("colourpicker-focus"),t.stop(!0,!0).fadeIn(a.showSpeed,function(){a.show&&a.show.call(r.get(0))}))}function o(){r(".colourpicker-focus").each(function(){var e=r(this),t=e.find(".colourpicker-input"),a=e.find(".colourpicker-panel"),o=t.data("colourpicker-settings");a.fadeOut(o.hideSpeed,function(){o.hide&&o.hide.call(t.get(0)),e.removeClass("colourpicker-focus")})})}function i(r,e,t){var a=r.parents(".colourpicker").find(".colourpicker-input"),o=a.data("colourpicker-settings"),i=r.find("[class$=-picker]"),n=r.offset().left,s=r.offset().top,l=Math.round(e.pageX-n),p=Math.round(e.pageY-s),u=t?o.animationSpeed:0;e.originalEvent.changedTouches&&(l=e.originalEvent.changedTouches[0].pageX-n,p=e.originalEvent.changedTouches[0].pageY-s),0>l&&(l=0),0>p&&(p=0),l>r.width()&&(l=r.width()),p>r.height()&&(p=r.height()),r.is(".colourpicker-grid")?i.stop(!0).animate({top:p+"px",left:l+"px"},u,o.animationEasing,function(){c(a,r)}):i.stop(!0).animate({top:p+"px"},u,o.animationEasing,function(){c(a,r)})}function c(r,e){function t(r,e){var t,a;return r.length&&e?(t=r.offset().left,a=r.offset().top,{x:t-e.offset().left+r.outerWidth()/2,y:a-e.offset().top+r.outerHeight()/2}):null}var a,o,i,c=r.val(),n=r.parent(),l=r.data("colourpicker-settings"),p=n.find(".colourpicker-grid"),d=n.find(".colourpicker-slider"),h=p.find("[class$=-picker]"),f=d.find("[class$=-picker]"),g=t(h,p),v=t(f,d);switch(e.is(".colourpicker-grid, .colourpicker-slider")&&(a=u(360-parseInt(v.y*(360/d.height()),10),0,360),o=u(Math.floor(g.x*(100/p.width())),0,100),i=u(100-Math.floor(g.y*(100/p.height())),0,100),c=k({h:a,s:o,b:i}),p.css("backgroundColor",k({h:a,s:100,b:100})),r.val(c.toUpperCase())),e.is(".cp-list-col")&&(c=e.data("cp-col"),r.val(c)),l.showColour){case"text":r.css("color",""),r.css("background-color","");break;case"background":r.css("color","transparent"),r.css("background-color",c);break;default:r.css("color",F(c)?"#ddd":"#000"),r.css("background-color",c)}"limited"==l.palette&&(n.find(".cp-list-col").removeClass("selected-col"),n.find(".cp-list-col[data-cp-col="+c+"]").addClass("selected-col").addClass(F(c)?"dark":"light")),s(r,c,r.data("transparent"))}function n(r,e){var t,a,o,i,c=r.parent(),n=r.data("colourpicker-settings"),p=c.find(".colourpicker-grid"),d=c.find(".colourpicker-slider"),h=p.find("[class$=-picker]"),g=d.find("[class$=-picker]");switch(t=l(r),t||(t=C(r)),a=f(t),e||r.val(t),n.showColour){case"text":r.css("color",""),r.css("background-color","");break;case"background":r.css("color","transparent"),r.css("background-color",t);break;default:r.css("color",F(t)?"#ddd":"#000"),r.css("background-color",t)}"limited"==n.palette&&(c.find(".cp-list-col").removeClass("selected-col"),c.find(".cp-list-col[data-cp-col="+t+"]").addClass("selected-col").addClass(F(t)?"dark":"light")),o=u(Math.ceil(a.s/(100/p.width())),0,p.width()),i=u(p.height()-Math.ceil(a.b/(100/p.height())),0,p.height()),h.css({top:i+"px",left:o+"px"}),i=u(d.height()-a.h/(360/d.height()),0,d.height()),g.css("top",i+"px"),p.css("backgroundColor",k({h:a.h,s:100,b:100})),r.data("colourpicker-initialized")&&s(r,t,r.data("transparent")),r.data("transparent")?(c.find(".colourpicker-istransparent").prop("checked",!0),c.addClass("istransparent")):(c.find(".colourpicker-istransparent").prop("checked",!1),c.removeClass("istransparent")),r.trigger("change").trigger("input")}function s(r,e,t){var a=r.data("colourpicker-settings"),o=r.data("colourpicker-lastChange"),i=r.data("colourpicker-lastTransparent");o&&o===e&&i===t||(r.data("colourpicker-lastChange",e),r.data("colourpicker-lastTransparent",t),a.change&&(a.changeDelay?(clearTimeout(r.data("colourpicker-changeTimeout")),r.data("colourpicker-changeTimeout",setTimeout(function(){a.change.call(r.get(0),e)},a.changeDelay))):a.change.call(r.get(0),e)),r.trigger("change").trigger("input"))}function l(e){var t=e.val(),a=e.data("colourpicker-settings"),o=p(t).toUpperCase();return"limited"==a.palette&&-1==r.inArray(o,a.allowedCols.split(" "))&&(o=""),o}function p(r){return r=r.replace(/[^A-F0-9]/gi,""),3!==r.length&&6!==r.length?"":(3===r.length&&(r=r[0]+r[0]+r[1]+r[1]+r[2]+r[2]),"#"+r)}function u(r,e,t){return e>r&&(r=e),r>t&&(r=t),r}function d(r){var e={},t=Math.round(r.h),a=Math.round(255*r.s/100),o=Math.round(255*r.b/100);if(0===a)e.r=e.g=e.b=o;else{var i=o,c=(255-a)*o/255,n=(i-c)*(t%60)/60;360===t&&(t=0),60>t?(e.r=i,e.b=c,e.g=c+n):120>t?(e.g=i,e.b=c,e.r=i-n):180>t?(e.g=i,e.r=c,e.b=c+n):240>t?(e.b=i,e.r=c,e.g=i-n):300>t?(e.b=i,e.g=c,e.r=c+n):360>t?(e.r=i,e.g=c,e.b=i-n):(e.r=0,e.g=0,e.b=0)}return{r:Math.round(e.r),g:Math.round(e.g),b:Math.round(e.b)}}function h(e){var t=[e.r.toString(16),e.g.toString(16),e.b.toString(16)];return r.each(t,function(r,e){1===e.length&&(t[r]="0"+e)}),"#"+t.join("")}function k(r){return h(d(r))}function f(r){var e=g(v(r));return 0===e.s&&(e.h=360),e}function g(r){var e={h:0,s:0,b:0},t=Math.min(r.r,r.g,r.b),a=Math.max(r.r,r.g,r.b),o=a-t;return e.b=a,e.s=0!==a?255*o/a:0,e.h=0!==e.s?r.r===a?(r.g-r.b)/o:r.g===a?2+(r.b-r.r)/o:4+(r.r-r.g)/o:-1,e.h*=60,e.h<0&&(e.h+=360),e.s*=100/255,e.b*=100/255,e}function v(r){return r=parseInt(r.indexOf("#")>-1?r.substring(1):r,16),{r:r>>16,g:(65280&r)>>8,b:255&r}}function F(r){return b(r)>.22?!1:!0}function b(e){var t=v(e);t=r.map(t,function(r){return r/=255,r=.03928>=r?r/12.92:Math.pow((r+.055)/1.055,2.4)});var a=.2126*t[0]+.7152*t[1]+.0722*t[2];return a}function C(r){if(r.data("colourpicker-lastChange"))return r.data("colourpicker-lastChange");if(r.parent().is(".palette-limited")){var e=r.parent().find(".cp-list-col").first();return e.data("cp-col")}return"#FFFFFF"}r.colourpicker={defaults:{animationSpeed:50,animationEasing:"swing",change:null,changeDelay:0,hide:null,hideSpeed:100,show:null,showSpeed:100,showColour:"both",allowTransparent:!1,transparentText:"Transparent",palette:"square",allowedCols:"#000000 #333333 #4C4C4C #666666 #7F7F7F #999999 #B3B3B3 #E6E6E6 #FFFFFF #004080 #000080 #0000FF #0080FF #66CCFF #66FFFF #00FFFF #008080 #008040 #408000 #008000 #00FF00 #80FF00 #66FF66 #00FF80 #66FFCC #804000 #800000 #FF0000 #FF6666 #FF8000 #FFFF00 #FFFF66 #FFCC66 #400080 #800080 #800040 #8000FF #FF00FF #FF0080 #CC66FF"}},r.extend(r.fn,{colourpicker:function(i,c){switch(i){case"destroy":return r(this).each(function(){t(r(this))}),r(this);case"hide":return o(),r(this);case"settings":return void 0===c?r(this).data("colourpicker-settings"):(r(this).each(function(){var e=r(this).data("colourpicker-settings")||{};t(r(this)),r(this).colourpicker(r.extend(!0,e,c))}),r(this));case"show":return a(r(this).eq(0)),r(this);case"value":return void 0===c?r(this).data("allow-transparent")&&r(this).data("transparent")?"transparent":l(r(this))?l(r(this)):r(this).data("colourpicker-lastChange"):(r(this).each(function(){"transparent"==c?r(this).data("allow-transparent")?r(this).data("transparent",!0):(r(this).data("transparent",!1),r(this).val(C(r(this)))):(r(this).data("transparent",!1),r(this).val(c)),n(r(this))}),r(this));default:return"create"!==i&&(c=i),r(this).each(function(){e(r(this),c)}),r(this)}}}),r(document).on("mousedown.colourpicker touchstart.colourpicker",function(e){r(e.target).parents().add(e.target).hasClass("colourpicker")||o()}).on("mousedown.colourpicker touchstart.colourpicker",".cp-list-col",function(e){var t=r(this);e.preventDefault();var a=t.parents(".colourpicker").find(".colourpicker-input");c(a,t)}).on("mousedown.colourpicker touchstart.colourpicker",".colourpicker-grid, .colourpicker-slider",function(e){var t=r(this);e.preventDefault(),r(document).data("colourpicker-target",t),i(t,e,!0)}).on("mousemove.colourpicker touchmove.colourpicker",function(e){var t=r(document).data("colourpicker-target");t&&i(t,e)}).on("mouseup.colourpicker touchend.colourpicker",function(){r(this).removeData("colourpicker-target")}).on("focus.colourpicker",".colourpicker-input",function(){var e=r(this);e.data("colourpicker-initialized")&&(e.data("transparent",!1),a(e),n(r(this)))}).on("blur.colourpicker",".colourpicker-input",function(){{var e=r(this);e.data("colourpicker-settings")}e.data("colourpicker-initialized")&&(e.val(l(e)),""===e.val()&&e.val(C(e)),e.val(e.val().toUpperCase()))}).on("keydown.colourpicker",".colourpicker-input",function(e){var t=r(this);if(t.data("colourpicker-initialized"))switch(e.keyCode){case 9:o();break;case 13:case 27:o(),t.blur()}}).on("keyup.colourpicker",".colourpicker-input",function(){var e=r(this);e.data("colourpicker-initialized")&&n(e,!0)}).on("paste.colourpicker",".colourpicker-input",function(){var e=r(this);e.data("colourpicker-initialized")&&setTimeout(function(){n(e,!0)},1)}).on("change.colourpicker-istransparent",".input-group-addon",function(){var e=r(this).siblings(".colourpicker-input"),t=(e.parent(),r(this).find(".colourpicker-istransparent"));o(),e.data("transparent",t.is(":checked")),n(e)})});